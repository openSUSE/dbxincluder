<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dbxincluder API documentation &mdash; dbxincluder 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="dbxincluder 0.1.0 documentation" href="index.html" />
    <link rel="prev" title="Manual Page for dbxincluder" href="manpage.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="dbxincluder-api-documentation">
<h1>dbxincluder API documentation<a class="headerlink" href="#dbxincluder-api-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="internals">
<h2>Internals<a class="headerlink" href="#internals" title="Permalink to this headline">¶</a></h2>
<p>dbxincluder is divided into two parts:</p>
<p>The xinclude submodule handles the pure XInclude 1.1 specification.
It was necessary to re-implement it in Python as libxml2 does not handle all required XInclude 1.1 features itself.</p>
<p>When processing a document, it is first run through the XInclude processor, then the DocBook transclusion processor.</p>
</div>
<div class="section" id="dbxincluder-xinclude">
<h2>dbxincluder.xinclude<a class="headerlink" href="#dbxincluder-xinclude" title="Permalink to this headline">¶</a></h2>
<p>The XInclude process works in two stages:</p>
<p>The first stage handles all <code class="docutils literal"><span class="pre">xi:include</span></code> elements by replacing them with either the target subdocument
or the <code class="docutils literal"><span class="pre">xi:fallback</span></code> child, if available.</p>
<p>The second stage then handles the <code class="docutils literal"><span class="pre">xi:fallback</span></code> elements in the document by replacing them with their content.
As <code class="docutils literal"><span class="pre">xi:fallback</span></code> can contain muliple children, this can&#8217;t happen in the first stage due to the way the iteration works.</p>
<span class="target" id="module-dbxincluder.xinclude"></span><p>xinclude module: Processes raw XInclude 1.1 elements</p>
<dl class="exception">
<dt id="dbxincluder.xinclude.ResourceError">
<em class="property">exception </em><code class="descclassname">dbxincluder.xinclude.</code><code class="descname">ResourceError</code><span class="sig-paren">(</span><em>elem</em>, <em>message=None</em>, <em>file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.ResourceError" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as DBXIException, just for resource errors</p>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.append_to_tail">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">append_to_tail</code><span class="sig-paren">(</span><em>elem</em>, <em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.append_to_tail" title="Permalink to this definition">¶</a></dt>
<dd><p>Append str to elem&#8217;s tail.</p>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.append_to_text">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">append_to_text</code><span class="sig-paren">(</span><em>elem</em>, <em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.append_to_text" title="Permalink to this definition">¶</a></dt>
<dd><p>Append str to elem&#8217;s text.</p>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.copy_attributes">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">copy_attributes</code><span class="sig-paren">(</span><em>elem</em>, <em>subtree</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.copy_attributes" title="Permalink to this definition">¶</a></dt>
<dd><p>Modifies subtree according to
<a class="reference external" href="https://www.w3.org/XML/2012/08/xinclude-11/Overview.html#attribute-copying">https://www.w3.org/XML/2012/08/xinclude-11/Overview.html#attribute-copying</a>
with the attributes of elem. Does not return anything.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>elem</strong> &#8211; XInclude source elemend</li>
<li><strong>subtree</strong> &#8211; Target subtree/element</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.flatten_subtree">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">flatten_subtree</code><span class="sig-paren">(</span><em>tree</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.flatten_subtree" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all xi:fallback elements in tree by replacing them with their content.</p>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.get_target">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">get_target</code><span class="sig-paren">(</span><em>elem</em>, <em>base_url</em>, <em>file=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.get_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Return tuple of the content of the target document as string and the URL that was used</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>elem</strong> &#8211; XInclude element</li>
<li><strong>base_url</strong> &#8211; xml:base of the element</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><strong>DBXIException</strong> &#8211; href attribute is missing</li>
<li><strong>ResourceError</strong> &#8211; Couldn&#8217;t fetch target</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.handle_xifallback">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">handle_xifallback</code><span class="sig-paren">(</span><em>elem</em>, <em>file=None</em>, <em>xinclude_stack=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.handle_xifallback" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the xi:include tag elem.
It will be replaced by the content of the xi:fallback subelement.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>elem</strong> &#8211; The XInclude element to process</li>
<li><strong>file</strong> &#8211; URL used to report errors</li>
<li><strong>xinclude_stack</strong> &#8211; List (or None) of str with url and fragid to detect infinite recursion</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">True if xi:fallback found</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.handle_xinclude">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">handle_xinclude</code><span class="sig-paren">(</span><em>elem</em>, <em>base_url</em>, <em>file=None</em>, <em>xinclude_stack=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.handle_xinclude" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the xi:include tag elem.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>elem</strong> &#8211; The XInclude element to process</li>
<li><strong>base_url</strong> &#8211; xml:base to use if not specified in the document</li>
<li><strong>file</strong> &#8211; URL used to report errors</li>
<li><strong>xinclude_stack</strong> &#8211; List (or None) of str with url and fragid to detect infinite recursion</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.process_subtree">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">process_subtree</code><span class="sig-paren">(</span><em>tree</em>, <em>base_url</em>, <em>file</em>, <em>xinclude_stack</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.process_subtree" title="Permalink to this definition">¶</a></dt>
<dd><p>Like process_xinclude, but for subtrees.</p>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.process_tree">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">process_tree</code><span class="sig-paren">(</span><em>tree</em>, <em>base_url=None</em>, <em>file=None</em>, <em>xinclude_stack=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.process_tree" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes an ElementTree:
- Search and process xi:include
- Add xml:base (=source) to the root element</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tree</strong> &#8211; ElementTree to process (gets modified)</li>
<li><strong>base_url</strong> &#8211; xml:base to use if not set in the tree</li>
<li><strong>file</strong> &#8211; URL used to report errors</li>
<li><strong>xinclude_stack</strong> &#8211; Internal</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.process_xinclude">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">process_xinclude</code><span class="sig-paren">(</span><em>tree</em>, <em>base_url=None</em>, <em>file=None</em>, <em>xinclude_stack=None</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.process_xinclude" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes an ElementTree:
- Search and process xi:include
- Add xml:base (=source) to the root element</p>
<p>This does not resolve xi:fallback correctly.
Use process_tree for that.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tree</strong> &#8211; ElementTree to process (gets modified)</li>
<li><strong>base_url</strong> &#8211; xml:base to use if not set in the tree</li>
<li><strong>file</strong> &#8211; URL used to report errors</li>
<li><strong>xinclude_stack</strong> &#8211; Internal</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.xinclude.validate_xinclude">
<code class="descclassname">dbxincluder.xinclude.</code><code class="descname">validate_xinclude</code><span class="sig-paren">(</span><em>elem</em>, <em>file</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.xinclude.validate_xinclude" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise DBXIException if the XInclude element elem is not valid.</p>
</dd></dl>

</div>
<div class="section" id="dbxincluder-docbook">
<h2>dbxincluder.docbook<a class="headerlink" href="#dbxincluder-docbook" title="Permalink to this headline">¶</a></h2>
<p>The DocBook transclusion process works in three stages:</p>
<p>First, the XIncluded document is iterated and each element with <code class="docutils literal"><span class="pre">xml:id</span></code> set gets a new custom dbxi:newid attribute.
This is computed for each element separately, based on the nearest <code class="docutils literal"><span class="pre">trans:idfixup</span></code> and <code class="docutils literal"><span class="pre">trans:linkscope</span></code> values.</p>
<p>The second stage iterates the document again, finding all references to elements in the same document and updating them
to the new values of the <code class="docutils literal"><span class="pre">dbxi:newid</span></code> attributes.</p>
<p>The last pass cleans up the custom attributes by setting <code class="docutils literal"><span class="pre">xml:id</span></code> to the value of dbxi:newid and removing the <code class="docutils literal"><span class="pre">dbxi:</span></code> attributes.
It also removes DocBook transclusiton attributes (<code class="docutils literal"><span class="pre">trans:\*</span></code>) and unneeded namespace declarations.</p>
<span class="target" id="module-dbxincluder.docbook"></span><p>Handle the DocBook specific part of transclusion</p>
<dl class="function">
<dt id="dbxincluder.docbook.associate_new_ids">
<code class="descclassname">dbxincluder.docbook.</code><code class="descname">associate_new_ids</code><span class="sig-paren">(</span><em>subtree</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.docbook.associate_new_ids" title="Permalink to this definition">¶</a></dt>
<dd><p>Assign elements their new ids as new &#8216;dbxi:newid&#8217; attribute.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>subtree</strong> &#8211; The XIncluded subtree to process</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.docbook.find_target">
<code class="descclassname">dbxincluder.docbook.</code><code class="descname">find_target</code><span class="sig-paren">(</span><em>elem</em>, <em>subtree</em>, <em>value</em>, <em>linkscope</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.docbook.find_target" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolves reference to id value beginning from elem</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>elem</strong> &#8211; Source of reference</li>
<li><strong>subtree</strong> &#8211; XIncluded subtree</li>
<li><strong>value</strong> &#8211; ID of reference</li>
<li><strong>linkscope</strong> &#8211; DB transclusion linkscope (local/near/global)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Target element or None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.docbook.fixup_references">
<code class="descclassname">dbxincluder.docbook.</code><code class="descname">fixup_references</code><span class="sig-paren">(</span><em>subtree</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.docbook.fixup_references" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix all references if idfixup is set</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>subtree</strong> &#8211; subtree to process</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dbxincluder.docbook.process_tree">
<code class="descclassname">dbxincluder.docbook.</code><code class="descname">process_tree</code><span class="sig-paren">(</span><em>tree</em>, <em>base_url</em>, <em>file</em><span class="sig-paren">)</span><a class="headerlink" href="#dbxincluder.docbook.process_tree" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes an ElementTree.
Handles all xi:include with xinclude.process_tree
and processes all docbook attributes on the output.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>tree</strong> &#8211; ElementTree to process (gets modified)</li>
<li><strong>base_url</strong> &#8211; xml:base to use if not set in the tree</li>
<li><strong>file</strong> &#8211; URL used to report errors</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Nothing</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">dbxincluder API documentation</a><ul>
<li><a class="reference internal" href="#internals">Internals</a></li>
<li><a class="reference internal" href="#dbxincluder-xinclude">dbxincluder.xinclude</a></li>
<li><a class="reference internal" href="#dbxincluder-docbook">dbxincluder.docbook</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="manpage.html" title="previous chapter">Manual Page for dbxincluder</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/apidoc.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Fabian Vogt.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
      |
      <a href="_sources/apidoc.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>